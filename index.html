<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>FinCalcy - Multi-Currency Professional EMI Calculator</title>
    <meta name="description" content="A professional-grade EMI calculator with a clean interface, multi-currency support, detailed amortization schedule, and interactive charts.">
    <meta name="keywords" content="EMI Calculator, Loan Calculator, Multi-Currency, Professional, Financial Tool, Amortization">
    
    <link rel="icon" href="https://api.iconify.design/ant-design:calculator-filled.svg?color=%23ffffff" type="image/svg+xml">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Libraries for PDF and Excel Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.1/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

    <style>
        body { font-family: 'Inter', sans-serif; background-color: #f3f4f6; }
        .card { background-color: #ffffff; border-radius: 1rem; box-shadow: 0 10px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1); }
        input[type=range] { -webkit-appearance: none; width: 100%; height: 8px; background: #e5e7eb; border-radius: 9999px; outline: none; }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; appearance: none; width: 24px; height: 24px;
            background: #2563eb; cursor: pointer; border-radius: 50%;
            border: 4px solid #ffffff; box-shadow: 0 0 5px rgba(0,0,0,0.3);
        }
        .popup { display: none; }
        .popup.active { display: flex; }
        .dropdown-hover:hover .dropdown-menu { display: block; }
    </style>
</head>
<body class="text-slate-800">

    <!-- Header -->
    <header class="bg-[#2c2a4a] sticky top-0 z-50 shadow-lg">
        <nav class="container mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-20">
            <div class="flex items-center space-x-8">
                <div class="flex items-center space-x-3">
                    <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20"><path d="M10.894 2.553a1 1 0 00-1.788 0l-7 14a1 1 0 001.169 1.409l5-1.429A1 1 0 009 15.571V11a1 1 0 112 0v4.571a1 1 0 00.725.962l5 1.428a1 1 0 001.17-1.408l-7-14z"></path></svg>
                    <span class="text-2xl font-bold text-white">FinCalcy</span>
                </div>
                <ul class="hidden lg:flex items-center space-x-6 text-slate-300">
                    <li><a href="#" class="hover:text-white transition">Home</a></li>
                    <li class="relative dropdown-hover">
                        <a href="#" class="hover:text-white transition flex items-center">Calculators <svg class="w-4 h-4 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg></a>
                        <div class="absolute hidden dropdown-menu bg-slate-800 text-white rounded-lg shadow-xl mt-4 w-48 py-2">
                            <a href="#" class="block px-4 py-2 hover:bg-slate-700">Home Loan</a>
                        </div>
                    </li>
                    <li><a href="#" data-modal-target="about-us-modal" class="modal-trigger hover:text-white transition">About Us</a></li>
                    <li><a href="#" data-modal-target="qa-modal" class="modal-trigger hover:text-white transition">Q&A</a></li>
                    <li><a href="#" data-modal-target="contact-us-modal" class="modal-trigger hover:text-white transition">Contact Us</a></li>
                </ul>
            </div>
            <!-- Currency Dropdown -->
            <div class="relative">
                <button id="country-selector-btn" class="bg-slate-700/50 hover:bg-slate-600/50 text-white font-medium py-2 px-4 rounded-lg flex items-center space-x-2 transition"></button>
                <div id="country-selector-menu" class="absolute hidden bg-slate-800 rounded-lg shadow-xl mt-2 w-56 py-2 right-0 z-10"></div>
            </div>
        </nav>
    </header>

    <main class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
        <div class="text-center my-8">
            <h1 class="text-4xl font-bold text-slate-900">EMI Calculator</h1>
            <p class="text-slate-600 mt-2 text-lg">A clear path to your financial decisions.</p>
        </div>
        
        <div class="my-8 text-center bg-white h-24 flex items-center justify-center rounded-lg shadow"><span class="text-slate-400">Top Banner Ad (728x90)</span></div>
        
        <div class="grid grid-cols-12 gap-8">
            <aside class="hidden lg:block col-span-2"><div class="bg-white h-96 flex items-center justify-center rounded-lg shadow sticky top-40"><span class="text-slate-400">Left Sidebar Ad</span></div></aside>
            <div class="col-span-12 lg:col-span-8">
                <div class="card p-8 lg:p-10">
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12">
                        <div class="space-y-10">
                            <div><div class="flex justify-between items-center mb-2"><label class="font-semibold text-lg">Loan Amount</label><div class="border rounded-lg px-4 py-2 w-48 text-center"><span id="currency-symbol" class="font-bold text-lg"></span><input id="loanAmountInput" type="text" class="font-bold text-lg w-32 outline-none"></div></div><input id="loanAmount" type="range"><div class="flex justify-between text-slate-500 mt-2 font-medium"><span id="amount-min-label"></span><span id="amount-max-label"></span></div></div>
                            <div><div class="flex justify-between items-center mb-2"><label class="font-semibold text-lg">Tenure (Years)</label><div class="border rounded-lg px-4 py-2 w-28 text-center"><input id="loanTenureInput" type="number" class="font-bold text-lg w-10 outline-none" value="30"><span class="font-bold text-lg">Yrs</span></div></div><input id="loanTenure" type="range" min="1" max="30" value="30" step="1"><div class="flex justify-between text-slate-500 mt-2 font-medium"><span>1</span><span>30</span></div></div>
                            <div><div class="flex justify-between items-center mb-2"><label class="font-semibold text-lg">Interest Rate (% P.A.)</label><div class="border rounded-lg px-4 py-2 w-28 text-center"><input id="interestRateInput" type="number" class="font-bold text-lg w-12 outline-none" value="7.9" step="0.1"><span class="font-bold text-lg">%</span></div></div><input id="interestRate" type="range" min="0.5" max="15" value="7.9" step="0.1"><div class="flex justify-between text-slate-500 mt-2 font-medium"><span>0.5</span><span>15</span></div></div>
                        </div>
                        <div class="flex flex-col lg:flex-row items-center justify-between">
                            <div class="space-y-6 text-center lg:text-left">
                                <div><p class="text-slate-600 font-medium">Monthly EMI</p><p id="emiResult" class="text-4xl font-bold text-blue-700">--</p></div>
                                <div><p class="text-slate-600 font-medium">Principal Amount</p><p id="principalAmount" class="text-2xl font-semibold">--</p></div>
                                <div><p class="text-slate-600 font-medium">Interest Amount</p><p id="totalInterest" class="text-2xl font-semibold">--</p></div>
                                <div><p class="text-slate-600 font-medium">Total Amount Payable</p><p id="totalPayment" class="text-2xl font-semibold">--</p></div>
                            </div><div class="w-full max-w-xs mt-8 lg:mt-0"><canvas id="emiChart"></canvas></div>
                        </div>
                    </div>
                </div>
                <div class="mt-16"><div class="flex justify-between items-center mb-6"><h2 class="text-3xl font-bold text-slate-900">Amortization Schedule</h2><div class="flex space-x-3"><button id="downloadPdfBtn" class="bg-blue-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-blue-700 transition-colors">PDF</button><button id="downloadExcelBtn" class="bg-green-600 text-white font-semibold py-2 px-5 rounded-lg hover:bg-green-700 transition-colors">Excel</button></div></div><div class="card overflow-hidden"><div class="overflow-x-auto"><table class="w-full text-left"><thead class="bg-slate-100"><tr><th class="p-4 font-semibold">Year</th><th class="p-4 font-semibold">Opening Balance</th><th class="p-4 font-semibold">EMI * 12</th><th class="p-4 font-semibold">Interest Paid Yearly</th><th class="p-4 font-semibold">Principal Paid Yearly</th><th class="p-4 font-semibold">Closing Balance</th></tr></thead><tbody id="amortizationTable" class="divide-y divide-slate-200"></tbody></table></div></div></div>
                <div class="my-8 text-center bg-white h-24 flex items-center justify-center rounded-lg shadow"><span class="text-slate-400">Below Amortization Banner Ad</span></div>
            </div>
            <aside class="hidden lg:block col-span-2"><div class="bg-white h-96 flex items-center justify-center rounded-lg shadow sticky top-40"><span class="text-slate-400">Right Sidebar Ad</span></div></aside>
        </div>
    </main>
    
    <!-- Modals -->
    <div id="popupAd" class="popup fixed inset-0 bg-black/60 items-center justify-center z-[100]"><div class="card text-center p-8 relative w-11/12 max-w-md"><button class="modal-close absolute top-4 right-4 text-slate-500 hover:text-slate-800 text-2xl font-bold">&times;</button><h3 class="text-xl font-bold mb-4">Advertisement</h3><div class="bg-slate-200 h-48 flex items-center justify-center rounded-lg"><span class="text-slate-500">Popup Ad (300x250)</span></div></div></div>
    <div id="about-us-modal" class="popup fixed inset-0 bg-black/60 items-center justify-center z-[100]"><div class="card p-8 relative w-11/12 max-w-2xl max-h-[80vh] overflow-y-auto"><button class="modal-close absolute top-4 right-4 text-slate-500 hover:text-slate-800 text-2xl font-bold">&times;</button><div class="space-y-4 text-slate-700 leading-relaxed"><h2 class="text-3xl font-bold text-slate-900 mb-4">About Us – FinCalcy</h2><p>Welcome to FinCalcy, your trusted partner in smart financial planning...</p></div></div></div>
    <div id="contact-us-modal" class="popup fixed inset-0 bg-black/60 items-center justify-center z-[100]"><div class="card p-8 relative w-11/12 max-w-lg"><button class="modal-close absolute top-4 right-4 text-slate-500 hover:text-slate-800 text-2xl font-bold">&times;</button><h2 class="text-3xl font-bold text-slate-900 mb-4 text-center">Contact Us</h2><form action="https://formspree.io/f/YOUR_FORM_ID" method="POST" class="space-y-4"><p class="text-center text-sm text-slate-500"><strong>Important:</strong> Replace "YOUR_FORM_ID" in the code with your actual Formspree ID.</p><div><label for="name" class="block mb-1 font-medium">Name</label><input type="text" id="name" name="name" required class="w-full p-2 rounded-lg border focus:border-blue-600 focus:outline-none"></div><div><label for="email" class="block mb-1 font-medium">Email</label><input type="email" id="email" name="email" required class="w-full p-2 rounded-lg border focus:border-blue-600 focus:outline-none"></div><div><label for="message" class="block mb-1 font-medium">Message</label><textarea id="message" name="message" rows="4" required class="w-full p-2 rounded-lg border focus:border-blue-600 focus:outline-none"></textarea></div><button type="submit" class="w-full py-3 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 transition-all shadow-lg">Send Message</button></form></div></div>
    <div id="qa-modal" class="popup fixed inset-0 bg-black/60 items-center justify-center z-[100]"><div class="card p-8 relative w-11/12 max-w-3xl max-h-[80vh] overflow-y-auto"><button class="modal-close absolute top-4 right-4 text-slate-500 hover:text-slate-800 text-2xl font-bold">&times;</button><div class="space-y-6 text-left text-slate-700 leading-relaxed"><h2 class="text-3xl font-bold text-slate-900 mb-6">Frequently Asked Questions (Q&A)</h2><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q1. What is EMI?</h3><p>A: EMI (Equated Monthly Installment) is a fixed monthly payment you make to repay a loan. It includes both the principal amount and the interest.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q2. How does EMI work?</h3><p>A: Every month, you pay a fixed amount. In the beginning, more of your EMI goes towards interest, and later more goes towards the principal. This continues until the loan is fully paid.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q3. Does EMI calculation change with currency?</h3><p>A: No. The EMI formula is the same everywhere. Only the currency symbol changes (₹ for INR, $ for USD, € for EUR, £ for GBP, etc.).</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q4. What factors affect my EMI?</h3><p>A: Loan amount, interest rate, and loan tenure are the three main factors that decide your EMI.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q5. Can I calculate EMI for any country using this tool?</h3><p>A: Yes. Just select your preferred currency (like USD, INR, EUR, GBP, etc.), enter the loan amount, interest rate, and tenure — and the calculator will show the EMI in your chosen currency.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q6. What is the formula for EMI?</h3><p class="font-mono bg-slate-100 p-2 rounded">E = P × r × (1 + r)ⁿ / ((1 + r)ⁿ - 1)</p><p>Where P = loan amount, r = monthly interest rate, n = number of months.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q7. Is EMI the same for all types of loans?</h3><p>A: The EMI formula is the same, but the interest rate and tenure vary depending on loan type (home loan, car loan, personal loan, etc.).</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q8. Can I reduce my EMI amount?</h3><p>A: Yes. You can reduce EMI by choosing a longer tenure, getting a lower interest rate, or making part-prepayments.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q9. Will exchange rates affect my EMI?</h3><p>A: No, your EMI is fixed in the currency of your loan. Exchange rates only matter if you compare loans across countries.</p></div><div class="space-y-4"><h3 class="font-semibold text-lg text-slate-900">Q10. Is this EMI calculator accurate for my country?</h3><p>A: Yes. Since the EMI formula is universal, results are accurate for all countries. Just make sure you enter the correct interest rate and loan tenure as offered by banks in your country.</p></div><div class="mt-8 pt-6 border-t border-slate-200"><p class="text-center font-semibold text-blue-700">Have any other questions or queries? <a href="#" data-modal-target="contact-us-modal" class="modal-trigger underline">Go on Contact Us and ask.</a></p></div></div></div></div>
    
    <footer class="bg-slate-900"><div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 text-center text-slate-400"><p class="mb-4">&copy; 2025 FinCalcy. All Rights Reserved. | contact@fincalcy.com</p><div class="flex justify-center items-center space-x-2 sm:space-x-4"><a href="#" data-modal-target="about-us-modal" class="modal-trigger hover:text-white transition">About Us</a><span class="opacity-50">|</span><a href="#" data-modal-target="privacy-policy-modal" class="modal-trigger hover:text-white transition">Privacy Policy</a><span class="opacity-50">|</span><a href="#" data-modal-target="terms-conditions-modal" class="modal-trigger hover:text-white transition">Terms & Conditions</a><span class="opacity-50">|</span><a href="#" data-modal-target="contact-us-modal" class="modal-trigger hover:text-white transition">Help & Support</a></div></div></footer>

<script>
    // Embedded Font for PDF Export
    const customFontBase64 = 'AAEAAAARAQAABAAQR0RFRgQsAmsAAAXMAAABHkdQT1OS2Vv3AAAG/AAAAExHVEVGIwAD7gAABrQAAAAoT1MvMr6aTO8AAALcAAAAYFNUQVTs6s+VAAAFFAAAAFhjbWFwAIkCVQAAAxAAAAI4Z2x5ZgGgKoYAAAaUAAABBGhlYWQGFAgVAAABMAAAADZoaGVhA+IB6QAAAWQAAAAkaG10eB4kADoAAAHAAAAAOGxvY2ECkAJYAAAEfAAAAA5tYXhwARgAMQAAAVgAAAAgbmFtZTd86+gAAAOkAAAB0XBvc3QAAwAAAAAFSAAAACAAAwIAAZAABQAAAUwBZgAAAEcBTAFmAAAA9QAZAIQAAAAAAAAAAAAAAAAAAAABAAAgAAAAAAAAAAAAAAAAAABAADRPQHg/+D/4AHgACAAAAABAAAAAAAAAAAAAAAgAAAAAAACAAAAAwAAABQAAwABAAAAFAAEACgAAAAOAAgAAgAAAAQAIP//AAAAAAAg//8AAf/j/4/8f/EAAQAAAAAAAAAAAAAFAwQCAQoAEwAABQAWAg4aKyAAnAAAAAAAAAIAAgADAGQALgBoAAAAAAAAAAAAAAMAAwAAAAMAAAAcAAEAAAAAAwoAFAAEAAAAAgQGAAoAAAAAAA4AGgAIAAAAAQIAAAEACgACAAAAAQAAAgABAAcAAQAAAAADAAsABwABAAYAAAABAgAABQAOAAQAAQAGAAAAAQABAAEACQAOAAgABAAGAAAAAQACAAEADQAOAAQABAAGAAAAAQADAAEADgAOAAcABAAGAAAAAQAEAAIADAAOAAUABAAGAAAAAQAF//EAewA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/AD8APwA/-..';

document.addEventListener('DOMContentLoaded', () => {
    // --- ELEMENTS ---
    const sliders = { amount: document.getElementById('loanAmount'), rate: document.getElementById('interestRate'), tenure: document.getElementById('loanTenure') };
    const inputs = { amount: document.getElementById('loanAmountInput'), rate: document.getElementById('interestRateInput'), tenure: document.getElementById('loanTenureInput') };
    const results = { emi: document.getElementById('emiResult'), interest: document.getElementById('totalInterest'), payment: document.getElementById('totalPayment'), principal: document.getElementById('principalAmount') };
    const labels = { min: document.getElementById('amount-min-label'), max: document.getElementById('amount-max-label') };
    const amortizationTableBody = document.getElementById('amortizationTable');
    const countryBtn = document.getElementById('country-selector-btn');
    const countryMenu = document.getElementById('country-selector-menu');
    const currencySymbolEl = document.getElementById('currency-symbol');
    const downloadPdfBtn = document.getElementById('downloadPdfBtn');
    const downloadExcelBtn = document.getElementById('downloadExcelBtn');
    
    let emiChart, currentCountry;
    let amortizationDataForExport = [];

    const countries = {
        IN: { name: 'India', flag: '🇮🇳', currency: 'INR', locale: 'en-IN', default: 2500000, min: 100000, max: 100000000, step: 100000, minLabel: '1 Lac', maxLabel: '10 Cr' },
        US: { name: 'United States', flag: '🇺🇸', currency: 'USD', locale: 'en-US', default: 300000, min: 10000, max: 5000000, step: 10000, minLabel: '10k', maxLabel: '5M' },
        CA: { name: 'Canada', flag: '🇨🇦', currency: 'CAD', locale: 'en-CA', default: 300000, min: 10000, max: 5000000, step: 10000, minLabel: '10k', maxLabel: '5M' },
        AU: { name: 'Australia', flag: '🇦🇺', currency: 'AUD', locale: 'en-AU', default: 400000, min: 10000, max: 5000000, step: 10000, minLabel: '10k', maxLabel: '5M' },
        GB: { name: 'United Kingdom', flag: '🇬🇧', currency: 'GBP', locale: 'en-GB', default: 250000, min: 5000, max: 3000000, step: 5000, minLabel: '5k', maxLabel: '3M' },
        DE: { name: 'Germany', flag: '🇩🇪', currency: 'EUR', locale: 'de-DE', default: 250000, min: 5000, max: 3000000, step: 5000, minLabel: '5k', maxLabel: '3M' },
        FR: { name: 'France', flag: '🇫🇷', currency: 'EUR', locale: 'fr-FR', default: 250000, min: 5000, max: 3000000, step: 5000, minLabel: '5k', maxLabel: '3M' },
        NL: { name: 'Netherlands', flag: '🇳🇱', currency: 'EUR', locale: 'nl-NL', default: 250000, min: 5000, max: 3000000, step: 5000, minLabel: '5k', maxLabel: '3M' },
        NO: { name: 'Norway', flag: '🇳🇴', currency: 'NOK', locale: 'no-NO', default: 2500000, min: 100000, max: 30000000, step: 100000, minLabel: '100k', maxLabel: '30M' },
        JP: { name: 'Japan', flag: '🇯🇵', currency: 'JPY', locale: 'ja-JP', default: 30000000, min: 1000000, max: 500000000, step: 1000000, minLabel: '1M', maxLabel: '500M' },
    };
    
    const formatNumber = (num) => new Intl.NumberFormat(currentCountry.locale).format(num);
    const formatCurrency = (num) => new Intl.NumberFormat(currentCountry.locale, { style: 'currency', currency: currentCountry.currency, minimumFractionDigits: 0, maximumFractionDigits: 0 }).format(num);
    const parseFormattedNumber = (str) => Number(String(str).replace(/[^0-9.]/g, ''));

    const calculateAndDisplay = () => {
        const p = parseFormattedNumber(inputs.amount.value) || 0;
        const r = parseFloat(inputs.rate.value) / 12 / 100 || 0;
        const n = parseInt(inputs.tenure.value) * 12 || 0;
        if (p > 0 && r > 0 && n > 0) {
            const emi = (p * r * Math.pow(1 + r, n)) / (Math.pow(1 + r, n) - 1);
            results.emi.textContent = formatCurrency(emi);
            results.principal.textContent = formatCurrency(p);
            results.interest.textContent = formatCurrency((emi * n) - p);
            results.payment.textContent = formatCurrency(emi * n);
            updateEmiChart(p, (emi * n) - p);
            generateAmortizationSchedule(p, r, n, emi);
        }
    };
    
    const updateEmiChart = (principal, interest) => {
        const ctx = document.getElementById('emiChart').getContext('2d');
        if (emiChart) emiChart.destroy();
        emiChart = new Chart(ctx, { type: 'pie', data: { labels: ['Principal Amount', 'Interest Amount'], datasets: [{ data: [principal, interest], backgroundColor: ['#2563eb', '#93c5fd'], borderColor: '#ffffff', borderWidth: 4 }] }, options: { responsive: true, plugins: { legend: { display: false } } } });
    };

    const generateAmortizationSchedule = (p, r, n, emi) => {
        let openingBalance = p;
        amortizationTableBody.innerHTML = '';
        amortizationDataForExport = [];
        for (let year = 1; year <= n / 12; year++) {
            let interestYearly = 0, principalYearly = 0, currentOpeningBalance = openingBalance;
            for (let month = 1; month <= 12; month++) {
                const interestMonth = openingBalance * r, principalMonth = emi - interestMonth;
                interestYearly += interestMonth; principalYearly += principalMonth; openingBalance -= principalMonth;
            }
            const closingBalance = openingBalance > 0 ? openingBalance : 0;
            amortizationDataForExport.push({ year, openingBalance: currentOpeningBalance, emiPaid: emi * 12, interestPaid: interestYearly, principalPaid: principalYearly, closingBalance });
            amortizationTableBody.innerHTML += `<tr class="hover:bg-slate-50"><td class="p-4 font-medium">${year}</td><td class="p-4">${formatCurrency(currentOpeningBalance)}</td><td class="p-4">${formatCurrency(emi * 12)}</td><td class="p-4">${formatCurrency(interestYearly)}</td><td class="p-4">${formatCurrency(principalYearly)}</td><td class="p-4">${formatCurrency(closingBalance)}</td></tr>`;
            if (closingBalance <= 0) break;
        }
    };
    
    const setCountry = (countryCode) => {
        currentCountry = countries[countryCode];
        countryBtn.innerHTML = `<span>${currentCountry.flag}</span> <span class="hidden md:inline">${currentCountry.name}</span>`;
        currencySymbolEl.textContent = (new Intl.NumberFormat(currentCountry.locale, { style: 'currency', currency: currentCountry.currency }).formatToParts(1).find(p => p.type === 'currency') || { value: '$' }).value;
        sliders.amount.min = currentCountry.min; sliders.amount.max = currentCountry.max; sliders.amount.step = currentCountry.step; sliders.amount.value = currentCountry.default;
        inputs.amount.value = formatNumber(currentCountry.default);
        labels.min.textContent = currentCountry.minLabel; labels.max.textContent = currentCountry.maxLabel;
        calculateAndDisplay();
    };

    Object.keys(countries).forEach(code => {
        const country = countries[code];
        const item = document.createElement('a');
        item.href = '#'; item.className = 'block px-4 py-2 hover:bg-slate-700 text-white';
        item.innerHTML = `<span>${country.flag}</span> ${country.name}`;
        item.onclick = (e) => { e.preventDefault(); setCountry(code); countryMenu.classList.add('hidden'); };
        countryMenu.appendChild(item);
    });

    countryBtn.addEventListener('click', (e) => { e.stopPropagation(); countryMenu.classList.toggle('hidden'); });
    document.addEventListener('click', (e) => { if (!countryBtn.contains(e.target) && !countryMenu.contains(e.target)) countryMenu.classList.add('hidden'); });

    for (const key in sliders) {
        sliders[key].addEventListener('input', (e) => { inputs[key].value = (key === 'amount') ? formatNumber(e.target.value) : e.target.value; calculateAndDisplay(); });
        inputs[key].addEventListener('change', (e) => { let value = (key === 'amount') ? parseFormattedNumber(e.target.value) : e.target.value; sliders[key].value = value; if (key === 'amount') inputs[key].value = formatNumber(value); calculateAndDisplay(); });
    }
    
    // --- Download Listeners ---
    downloadPdfBtn.addEventListener('click', () => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.addFileToVFS("Custom-Arial.ttf", customFontBase64);
        doc.addFont("Custom-Arial.ttf", "CustomArial", "normal");
        doc.setFont("CustomArial");

        doc.text("Amortization Schedule - FinCalcy", 14, 15);
        
        doc.autoTable({
            head: [['Year', 'Opening Balance', 'EMI * 12', 'Interest Paid', 'Principal Paid', 'Closing Balance']],
            body: amortizationDataForExport.map(row => [
                row.year,
                formatCurrency(row.openingBalance),
                formatCurrency(row.emiPaid),
                formatCurrency(row.interestPaid),
                formatCurrency(row.principalPaid),
                formatCurrency(row.closingBalance)
            ]),
            startY: 20,
            styles: {
                font: "CustomArial",
                fontSize: 10
            }
        });
        doc.save('FinCalcy_Amortization_Schedule.pdf');
    });

    downloadExcelBtn.addEventListener('click', () => {
        const worksheetData = amortizationDataForExport.map(row => ({
            "Year": row.year, "Opening Balance": row.openingBalance, "EMI Paid Yearly": row.emiPaid,
            "Interest Paid Yearly": row.interestPaid, "Principal Paid Yearly": row.principalPaid, "Closing Balance": row.closingBalance
        }));
        const worksheet = XLSX.utils.json_to_sheet(worksheetData);
        worksheet['!cols'] = [ { wch: 8 }, { wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 20 }, { wch: 20 } ];
        const currencySymbol = (new Intl.NumberFormat(currentCountry.locale, { style: 'currency', currency: currentCountry.currency }).formatToParts(1).find(p => p.type === 'currency') || { value: '$' }).value;
        const currencyFormat = `"${currencySymbol}"#,##0`;
        const range = XLSX.utils.decode_range(worksheet['!ref']);
        for (let R = range.s.r + 1; R <= range.e.r; ++R) {
            for (let C = range.s.c + 1; C <= range.e.c; ++C) {
                const cell_address = { c: C, r: R };
                const cell_ref = XLSX.utils.encode_cell(cell_address);
                if (worksheet[cell_ref]) {
                    worksheet[cell_ref].z = currencyFormat;
                }
            }
        }
        const workbook = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(workbook, worksheet, "Amortization Schedule");
        XLSX.writeFile(workbook, "FinCalcy_Amortization_Schedule.xlsx");
    });

    setCountry('IN');
});
</script>

</body>
</html>